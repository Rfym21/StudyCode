# HTTP / HTTPS 协议

## HTTP 协议(超文本传输协议)

- 各版本区别
    1. HTTP/0.9
        - 只有一个命令: GET / index.html
        - 只有请求行,没有header等描述数据的信息
        - 服务器发送完毕,就关闭TCP连接
        - 通过ASCII码编码HTML资源
    2. HTTP/1.0
        - 增加了请求头,响应头 -> 实现客户端和服务器端的通信
        - 请求头: =>
            Accept: 客户端接受的数据类型
            Content-Type: 服务器返回的数据类型
            Accept-Encoding: 压缩格式
            Accept-Charest: 客户端接受的字符集
            Accept-Language: 客户端接受的语言
        - 响应头: =>
            Content-Type: 服务器返回的数据类型
            Content-Encoding: 服务器返回的压缩格式
        - 状态码
    3. HTTP/1.1
        - 持久连接 => 一个TCP连接可以传送多个HTTP请求和响应
        - HTTP队头阻塞 => 一个TCP连接中,同一时刻只能处理一个请求,其他请求需要等待
        - 增加对虚拟机的支持 => Host字段
        - 增加了Cookie
        - 1.1中TCP慢启动,宽带利用利用率低
        - 同时开启的多条TCP连接相互竞争带宽,会导致网络拥塞
    4. HTTP/2.0
        - 多路复用 => 一个TCP连接中,可以并行多个请求和响应
            1. 打造了一个二进制分帧层,将多个请求利用二进制分帧层处理一帧一帧的请求,每一帧的请求带上相应的id编号
            2. 服务器接收到请求后,根据id编号将请求重新组装成完整的请求
            3. 服务器响应该请求,将响应发送至二进制分帧层,再将响应分帧发送至客户端,由浏览器自行合成完整响应体
        - 多路复用中可以给重要资源加标记,服务器优先返回响应权重高的资源
        - 通知只能最多开启一条TCP连接
        - 头部压缩
        - TCP队头阻塞: 因为超时重传机制,一旦出现某个数据包丢失,整个TCP连接都会被阻塞,直到丢失的数据包被重传成功
        - TCP建立连接的延时
    5. HTTP/3.0
        - QUIC协议 => TCP + UDP
            1. 实现了TCP流量拥塞控制
            2. 集成了TLS加密
            3. 多路复用
            4. 快速握手

## HTTPS 协议(超文本传输安全协议)

- HTTPS = HTTP + SSL/TLS
- SSL/TLS
    1. SSL(Secure Sockets Layer) => 由网景公司开发
    2. TLS(Transport Layer Security) => 由IETF(Internet Engineering Task Force)标准化
- 对称加密
    1. 优点: 加密速度快
    2. 缺点: 密钥传输不安全
- 非对称加密
    1. 优点: 密钥传输安全
    2. 缺点: 加密速度慢
- 对称加密: 将要传输的数据进行加密
- 非对称加密: 让双方都拥有相同的密钥
- 非对称加密 + 对称加密的流程

    1. 客户端创建密钥对
    这一步在实际的SSL/TLS协议中并不发生，因为客户端并不需要创建非对称密钥对。实际上，服务器才是提供公钥的主体。

    2. 服务器创建非对称密钥对，并将公钥发送给客户端
    这一步是正确的。服务器生成一对非对称密钥（公钥和私钥），并将公钥包含在其数字证书中发送给客户端。数字证书由可信的证书颁发机构（CA）签署，确保公钥的合法性。

    3. 客户端验证服务器的证书
    在继续通信之前，客户端验证服务器的证书，确保其来自可信的CA，并且证书未被篡改。这一步非常重要，以防止中间人攻击。

    4. 客户端生成对称密钥，并用服务器的公钥加密该密钥
    这一过程被称为“预主密钥”生成。客户端生成一个随机的预主密钥，并使用服务器的公钥加密它。然后，客户端将这个加密后的预主密钥发送给服务器。

    5. 服务器使用私钥解密预主密钥
    服务器使用它的私钥解密客户端发送的预主密钥。现在，客户端和服务器都拥有相同的预主密钥。

    6. 生成主密钥和会话密钥
    利用预主密钥以及双方各自的随机数（在前面的握手阶段交换的随机数），客户端和服务器生成相同的主密钥。然后，从这个主密钥派生出用于对称加密的会话密钥。

    7. 使用对称加密进行通信
    客户端和服务器现在都拥有相同的会话密钥，接下来的通信将使用对称加密进行，加密和解密消息都使用这个对称密钥。

    以下是基于上述步骤的详细流程图：
                                  客户端              服务器
                                    |                     |
                                    | <------1. ServerHello和证书-----  |
                                    |                     |
                                    |---2. 验证证书-------->|
                                    |                     |
                                    |                     |
                                    |---3. ClientKeyExchange（加密的预主密钥）-->|
                                    |                     |
                                    |                     |
                                    |<---4. 解密预主密钥---|
                                    |                     |
                                    |                     |
                                    |<---5. 生成主密钥和会话密钥--->|
                                    |                     |
                                    |---6. ChangeCipherSpec-->|
                                    |                     |
                                    |---7. Finished消息------>|
                                    |                     |
                                    |<---6. ChangeCipherSpec---|
                                    |                     |
                                    |<---7. Finished消息----|
                                    |                     |
                                    |---8. 对称加密通信---->|
                                    |<---8. 对称加密通信---|
