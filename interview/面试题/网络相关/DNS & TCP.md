# DNS & TCP

## DNS解析(DNS)

  ![dns](https://s7.51cto.com/oss/202203/22/c7a914f46a62d06c7eb693a79369dad331375a.png)

- DNS解析过程
  1. 本地DNS服务器递归查询
  2. 根域名服务器查询
  3. 顶级域名服务器查询
  4. 目标服务器查询
  5. 返回结果,并缓存IP地址

## TCP协议

  ![TCP握手](https://img.picui.cn/free/2024/08/19/66c2f312d8448.png)

- TCP三次握手 => 建立连接
  1. 客户端向服务端发送建立连接请求,客户端进入SYM-SENT状态(报文已发送,等待确认)
  2. 服务端接收到请求,向客户端发送同意连接请求的应答,服务端进入SYN-RECEIVED状态(报文已接收,等待确认)
  3. 客户端接收到应答,向服务端发送确认,客户端和服务端进入ESTABLISHED状态(连接已建立)

- TCP为什么是三次握手
  1. 防止已失效的连接请求报文段突然又传送到了服务端,因而产生错误
    =>
        客户端向服务器发送请求但是因为网络原因导致发送到服务器超时
        客户端触发重发机制
        如果第二次比第一次先响应成功并建立连接,并且数据传输完毕,关闭连接
        之后第一次的请求在网络中延迟到达服务端
        服务端接收到第一次请求,建立连接
        此时客户端已经关闭连接,服务端仍然处理已建立待数据传输,但是客户端并不知道,而服务器则一直等待客户端的数据传输

  2. 保证双方都能收到对方的确认

- TCP四次挥手 => 断开连接
  1. 客户端向服务端发送断开连接请求,客户端进入FIN-WAIT-1状态(等待服务端的确认)
  2. 服务端接收到请求,向客户端发送确认,服务端进入CLOSE-WAIT状态(等待客户端的断开请求),如果服务端有数据需要传输,则会传输完数据后再发送确认
  3. 服务端向客户端发送断开连接请求,服务端进入LAST-ACK状态(等待客户端的确认)
  4. 客户端接收到请求等待2MSL,向服务端发送确认,客户端和服务端进入CLOSED状态(连接已断开)

![TCP挥手](https://vip.helloimg.com/i/2024/08/19/66c345568a6e2.png)
